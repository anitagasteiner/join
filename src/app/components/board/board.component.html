<div class="main-container" [ngClass]="{'overflow-hidden': tasksService.addTaskContainerOpened}">
    
    <div class="search-add-container">

        @if (tasksService.addTaskContainerOpened && !tasksService.editTaskContainerOpened) {

            <div class="add-task-container">
    
                <h2>Add Task</h2>
    
                <app-add-task-form></app-add-task-form>
    
            </div>
    
        }

        @if (tasksService.editTaskContainerOpened) {

            <div class="add-task-container">
    
                <h2>Edit Task</h2>
    
                <app-add-task-form></app-add-task-form>
    
            </div>
    
        }

        <input class="search-task" placeholder="Find task" onfocus="this.placeholder=''" type="text" name="find-task" id="findTask">
     
        <button class="btn-submit">Add task</button>

    </div>

    @if (tasksService.taskDetailsOpened) {

        <div class="bg-light">

            <app-task-details></app-task-details>
    
        </div>

    }

    <div class="tasks-main-container">

        <div class="tasks-container">

            <div>
                To do
                <img src="/img/plus-btn.svg" (click)="openAddTaskContainer('to-do')">
            </div>

            @if (tasks$ | async; as tasks) {
                <div cdkDropList [cdkDropListData]="tasks" [cdkDropListConnectedTo]="['inProgressList', 'waitingList', 'doneList']" cdkDropListGroup id="toDoList" (cdkDropListDropped)="drop($event, 'to-do')">
                    @if (todoCount$ | async) {
                        @for (task of tasks$ | async; track task.id; let index = $index) {
                            @if (task.status == "to-do") {
                                <app-task cdkDrag [cdkDragData]="task" [task]="task" (click)="showTaskDetails(task)"></app-task>
                            }         
                        }
                    } @else {
                        <app-no-tasks [status]="'to do'"></app-no-tasks>
                    }
                </div>
            }

        </div>

        <div class="tasks-container">

            <div>
                In progress
                <img src="/img/plus-btn.svg" (click)="openAddTaskContainer('in-progress')">
            </div>

            @if (tasks$ | async; as tasks) {
                <div cdkDropList [cdkDropListData]="tasks" [cdkDropListConnectedTo]="['toDoList', 'waitingList', 'doneList']" id="inProgressList" (cdkDropListDropped)="drop($event, 'in-progress')">
                    @if (inProgressCount$ | async) {
                        @for (task of tasks$ | async; track task.title; let index = $index) {
                            @if (task.status == "in-progress") {
                                <app-task cdkDrag [cdkDragData]="task" [task]="task" (click)="showTaskDetails(task)"></app-task>
                            }            
                        }
                    } @else {
                        <app-no-tasks [status]="'in progress'"></app-no-tasks>
                    }
                    
                </div>
            }

        </div>

        <div class="tasks-container">

            <div>
                Awaiting feedback
                <img src="/img/plus-btn.svg" (click)="openAddTaskContainer('waiting')">
            </div>

            @if (tasks$ | async; as tasks) {
                <div cdkDropList [cdkDropListData]="tasks" [cdkDropListConnectedTo]="['toDoList', 'inProgressList', 'doneList']" id="waitingList" (cdkDropListDropped)="drop($event, 'waiting')">
                    @if (waitingCount$ | async) {
                        @for (task of tasks$ | async; track task.title; let index = $index) {
                            @if (task.status == "waiting") {
                                <app-task cdkDrag [cdkDragData]="task" [task]="task" (click)="showTaskDetails(task)"></app-task>
                            }            
                        }
                    } @else {
                        <app-no-tasks [status]="'waiting'"></app-no-tasks>
                    }                
                </div>  
            }          

        </div>

        <div class="tasks-container">

            <div>
                Done
            </div>

            @if (tasks$ | async; as tasks) {
                <div cdkDropList [cdkDropListData]="tasks" [cdkDropListConnectedTo]="['toDoList', 'inProgressList', 'waitingList']" id="doneList" (cdkDropListDropped)="drop($event, 'done')">
                    @if (doneCount$ | async) {
                        @for (task of tasks$ | async; track task.title; let index = $index) {
                            @if (task.status == "done") {
                                <app-task cdkDrag [cdkDragData]="task" [task]="task" (click)="showTaskDetails(task)"></app-task>
                            }            
                        }
                    } @else {
                        <app-no-tasks [status]="'done'"></app-no-tasks>
                    }
                </div>
            }

        </div>        

    </div>

</div>